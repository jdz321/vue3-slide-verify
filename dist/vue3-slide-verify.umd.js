(function(t,m){typeof exports=="object"&&typeof module!="undefined"?module.exports=m(require("vue")):typeof define=="function"&&define.amd?define(["vue"],m):(t=typeof globalThis!="undefined"?globalThis:t||self,t.vue3SlideVerify=m(t.Vue))})(this,function(t){"use strict";const m=Math.PI;function V(e,n){return e+n}function R(e){return e*e}function M(e,n,s,o,l,u){e.beginPath(),e.moveTo(n,s),e.arc(n+o/2,s-l+2,l,.72*m,2.26*m),e.lineTo(n+o,s),e.arc(n+o+l-2,s+o/2,l,1.21*m,2.78*m),e.lineTo(n+o,s+o),e.lineTo(n,s+o),e.arc(n+l-2,s+o/2,l+.4,2.76*m,1.24*m,!0),e.lineTo(n,s),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e[u](),e.globalCompositeOperation="destination-over"}function $(e,n){const s=document.createElement("img");return s.crossOrigin="Anonymous",s.onload=n,s.onerror=()=>{s.src=k(e)},s.src=k(e),s}function y(e,n){return Math.round(Math.random()*(n-e)+e)}function k(e){const n=e.length;return n>0?e[y(0,n)]:"https://picsum.photos/300/150/?image="+y(0,1084)}function L(){const e=t.reactive({x:0,y:0}),n=t.ref(!1),s=t.ref(!1),o=t.ref(0),l=t.ref([]);return{origin:e,success:n,isMouseDown:s,timestamp:o,trail:l,start:r=>{n.value||(r instanceof MouseEvent?(e.x=r.clientX,e.y=r.clientY):(e.x=r.changedTouches[0].pageX,e.y=r.changedTouches[0].pageY),s.value=!0,o.value=Date.now())},move:(r,f,a)=>{if(!s.value)return!1;let i=0,h=0;if(f instanceof MouseEvent?(i=f.clientX-e.x,h=f.clientY-e.y):(i=f.changedTouches[0].pageX-e.x,h=f.changedTouches[0].pageY-e.y),i<0||i+38>=r)return!1;a(i),l.value.push(h)},end:(r,f)=>{if(!s.value||(s.value=!1,(r instanceof MouseEvent?r.clientX:r.changedTouches[0].pageX)===e.x))return!1;o.value=Date.now()-o.value,f(o.value)},verify:(r,f,a)=>{const i=l.value,h=i.reduce(V)/i.length,w=i.map(g=>g-h),E=Math.sqrt(w.map(R).reduce(V)/i.length),C=parseInt(r);return a=a<=1?1:a>10?10:a,{spliced:Math.abs(C-f)<=a,TuringTest:h!==E}}}}var ee="",q=(e,n)=>{const s=e.__vccOpts||e;for(const[o,l]of n)s[o]=l;return s};const O=t.defineComponent({name:"SlideVerify",props:{l:{type:Number,default:42},r:{type:Number,default:10},w:{type:Number,default:310},h:{type:Number,default:155},sliderText:{type:String,default:"Slide filled right"},accuracy:{type:Number,default:5},show:{type:Boolean,default:!0},imgs:{type:Array,default:()=>[]}},emits:["success","again","fail","refresh"],setup(e,{emit:n}){const{imgs:s,l:o,r:l,w:u,h:d,accuracy:T}=e,b=t.ref(!0),r=t.ref(0),f=t.ref(0),a=t.reactive({containerActive:!1,containerSuccess:!1,containerFail:!1}),i=t.reactive({iconCls:"arrow-right",width:"0",left:"0"}),h=t.ref(),w=t.ref(),E=t.ref(),C=t.ref();let g;const{success:N,start:I,move:B,end:D,verify:K}=L(),X=()=>{var c,v;N.value=!1,a.containerActive=!1,a.containerSuccess=!1,a.containerFail=!1,i.iconCls="arrow-right",i.left="0",i.width="0",h.value.style.left="0",(c=C.value)==null||c.clearRect(0,0,u,d),(v=w.value)==null||v.clearRect(0,0,u,d),h.value.width=u,g.src=k(s)},Q=()=>{X(),n("refresh")};function A(c){i.left=c+"px";let v=(u-40-20)/(u-40)*c;h.value.style.left=v+"px",a.containerActive=!0,i.width=c+"px"}function z(c){const{spliced:v,TuringTest:S}=K(h.value.style.left,r.value,T);if(v){if(T===-1){a.containerSuccess=!0,i.iconCls="success",N.value=!0,n("success",c);return}S?(a.containerSuccess=!0,i.iconCls="success",N.value=!0,n("success",c)):(a.containerFail=!0,i.iconCls="fail",n("again"))}else a.containerFail=!0,i.iconCls="fail",n("fail"),setTimeout(()=>{X()},1e3)}const U=c=>{B(u,c,A)},Z=c=>{D(c,z)};return t.onMounted(()=>{var S,Y;const c=(S=E.value)==null?void 0:S.getContext("2d"),v=(Y=h.value)==null?void 0:Y.getContext("2d");C.value=c,w.value=v,g=$(s,()=>{b.value=!1;const p=o+l*2+3;if(r.value=y(p+10,u-(p+10)),f.value=y(10+l*2,d-(p+10)),c&&v){M(c,r.value,f.value,o,l,"fill"),M(v,r.value,f.value,o,l,"clip"),c.drawImage(g,0,0,u,d),v.drawImage(g,0,0,u,d);const F=f.value-l*2-1,x=v.getImageData(r.value,F,p,p);h.value.width=p,v.putImageData(x,0,F)}}),document.addEventListener("mousemove",p=>{B(u,p,A)}),document.addEventListener("mouseup",p=>{D(p,z)})}),{block:h,canvas:E,loadBlock:b,containerCls:a,sliderBox:i,refresh:Q,sliderDown:I,touchStartEvent:I,touchMoveEvent:U,touchEndEvent:Z}}}),P=e=>(t.pushScopeId("data-v-74359359"),e=e(),t.popScopeId(),e),_=["width","height"],j=[P(()=>t.createElementVNode("i",{class:"iconfont icon-refresh"},null,-1))],W=["width","height"],G={class:"slide-verify-slider-text"};function H(e,n,s,o,l,u){return t.openBlock(),t.createElementBlock("div",{id:"slideVerify",class:"slide-verify",style:t.normalizeStyle({width:e.w+"px"}),onselectstart:"return false;"},[t.createElementVNode("div",{class:t.normalizeClass({"slider-verify-loading":e.loadBlock})},null,2),t.createElementVNode("canvas",{ref:"canvas",width:e.w,height:e.h},null,8,_),e.show?(t.openBlock(),t.createElementBlock("div",{key:0,class:"slide-verify-refresh-icon",onClick:n[0]||(n[0]=(...d)=>e.refresh&&e.refresh(...d))},j)):t.createCommentVNode("",!0),t.createElementVNode("canvas",{ref:"block",width:e.w,height:e.h,class:"slide-verify-block"},null,8,W),t.createElementVNode("div",{class:t.normalizeClass(["slide-verify-slider",{"container-active":e.containerCls.containerActive,"container-success":e.containerCls.containerSuccess,"container-fail":e.containerCls.containerFail}])},[t.createElementVNode("div",{class:"slide-verify-slider-mask",style:t.normalizeStyle({width:e.sliderBox.width})},[t.createElementVNode("div",{class:"slide-verify-slider-mask-item",style:t.normalizeStyle({left:e.sliderBox.left}),onMousedown:n[1]||(n[1]=(...d)=>e.sliderDown&&e.sliderDown(...d)),onTouchstart:n[2]||(n[2]=(...d)=>e.touchStartEvent&&e.touchStartEvent(...d)),onTouchmove:n[3]||(n[3]=(...d)=>e.touchMoveEvent&&e.touchMoveEvent(...d)),onTouchend:n[4]||(n[4]=(...d)=>e.touchEndEvent&&e.touchEndEvent(...d))},[t.createElementVNode("i",{class:t.normalizeClass(["slide-verify-slider-mask-item-icon","iconfont",`icon-${e.sliderBox.iconCls}`])},null,2)],36)],4),t.createElementVNode("span",G,t.toDisplayString(e.sliderText),1)],2)],4)}var J=q(O,[["render",H],["__scopeId","data-v-74359359"]]);return J});
