(function(p,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(p=typeof globalThis!="undefined"?globalThis:p||self,t(p.vue3SlideVerify={},p.Vue))})(this,function(p,t){"use strict";const g=Math.PI;function I(e,n){return e+n}function $(e){return e*e}function B(e,n,s,o,l,u){e.beginPath(),e.moveTo(n,s),e.arc(n+o/2,s-l+2,l,.72*g,2.26*g),e.lineTo(n+o,s),e.arc(n+o+l-2,s+o/2,l,1.21*g,2.78*g),e.lineTo(n+o,s+o),e.lineTo(n,s+o),e.arc(n+l-2,s+o/2,l+.4,2.76*g,1.24*g,!0),e.lineTo(n,s),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e[u](),e.globalCompositeOperation="destination-over"}function L(e,n){const s=document.createElement("img");return s.crossOrigin="Anonymous",s.onload=n,s.onerror=()=>{s.src=T(e)},s.src=T(e),s}function w(e,n){return Math.round(Math.random()*(n-e)+e)}function T(e){const n=e.length;return n>0?e[w(0,n)]:"https://picsum.photos/300/150/?image="+w(0,1084)}function O(){const e=t.reactive({x:0,y:0}),n=t.ref(!1),s=t.ref(!1),o=t.ref(0),l=t.ref([]);return{origin:e,success:n,isMouseDown:s,timestamp:o,trail:l,start:a=>{n.value||(a instanceof MouseEvent?(e.x=a.clientX,e.y=a.clientY):(e.x=a.changedTouches[0].pageX,e.y=a.changedTouches[0].pageY),s.value=!0,o.value=Date.now())},move:(a,f,r)=>{if(!s.value)return!1;let i=0,h=0;if(f instanceof MouseEvent?(i=f.clientX-e.x,h=f.clientY-e.y):(i=f.changedTouches[0].pageX-e.x,h=f.changedTouches[0].pageY-e.y),i<0||i+38>=a)return!1;r(i),l.value.push(h)},end:(a,f)=>{if(!s.value||(s.value=!1,(a instanceof MouseEvent?a.clientX:a.changedTouches[0].pageX)===e.x))return!1;o.value=Date.now()-o.value,f(o.value)},verify:(a,f,r)=>{const i=l.value,h=i.reduce(I)/i.length,E=i.map(y=>y-h),C=Math.sqrt(E.map($).reduce(I)/i.length),S=parseInt(a);return r=r<=1?1:r>10?10:r,{spliced:Math.abs(S-f)<=r,TuringTest:h!==C}}}}var ne="",P=(e,n)=>{const s=e.__vccOpts||e;for(const[o,l]of n)s[o]=l;return s};const q=t.defineComponent({name:"SlideVerify",props:{l:{type:Number,default:42},r:{type:Number,default:10},w:{type:Number,default:310},h:{type:Number,default:155},sliderText:{type:String,default:"Slide filled right"},accuracy:{type:Number,default:5},show:{type:Boolean,default:!0},imgs:{type:Array,default:()=>[]}},emits:["success","again","fail","refresh"],setup(e,{emit:n}){const{imgs:s,l:o,r:l,w:u,h:d,accuracy:N}=e,V=t.ref(!0),a=t.ref(0),f=t.ref(0),r=t.reactive({containerActive:!1,containerSuccess:!1,containerFail:!1}),i=t.reactive({iconCls:"arrow-right",width:"0",left:"0"}),h=t.ref(),E=t.ref(),C=t.ref(),S=t.ref();let y;const{success:M,start:D,move:X,end:A,verify:U}=O(),z=()=>{var c,m;M.value=!1,r.containerActive=!1,r.containerSuccess=!1,r.containerFail=!1,i.iconCls="arrow-right",i.left="0",i.width="0",h.value.style.left="0",(c=S.value)==null||c.clearRect(0,0,u,d),(m=E.value)==null||m.clearRect(0,0,u,d),h.value.width=u,y.src=T(s)},Z=()=>{z(),n("refresh")};function Y(c){i.left=c+"px";let m=(u-40-20)/(u-40)*c;h.value.style.left=m+"px",r.containerActive=!0,i.width=c+"px"}function F(c){const{spliced:m,TuringTest:b}=U(h.value.style.left,a.value,N);if(m){if(N===-1){r.containerSuccess=!0,i.iconCls="success",M.value=!0,n("success",c);return}b?(r.containerSuccess=!0,i.iconCls="success",M.value=!0,n("success",c)):(r.containerFail=!0,i.iconCls="fail",n("again"))}else r.containerFail=!0,i.iconCls="fail",n("fail"),setTimeout(()=>{z()},1e3)}const x=c=>{X(u,c,Y)},ee=c=>{A(c,F)};return t.onMounted(()=>{var b,R;const c=(b=C.value)==null?void 0:b.getContext("2d"),m=(R=h.value)==null?void 0:R.getContext("2d");S.value=c,E.value=m,y=L(s,()=>{V.value=!1;const v=o+l*2+3;if(a.value=w(v+10,u-(v+10)),f.value=w(10+l*2,d-(v+10)),c&&m){B(c,a.value,f.value,o,l,"fill"),B(m,a.value,f.value,o,l,"clip"),c.drawImage(y,0,0,u,d),m.drawImage(y,0,0,u,d);const _=f.value-l*2-1,te=m.getImageData(a.value,_,v,v);h.value.width=v,m.putImageData(te,0,_)}}),document.addEventListener("mousemove",v=>{X(u,v,Y)}),document.addEventListener("mouseup",v=>{A(v,F)})}),{block:h,canvas:C,loadBlock:V,containerCls:r,sliderBox:i,refresh:Z,sliderDown:D,touchStartEvent:D,touchMoveEvent:x,touchEndEvent:ee}}}),j=e=>(t.pushScopeId("data-v-2dc70b4c"),e=e(),t.popScopeId(),e),W=["width","height"],G=[j(()=>t.createElementVNode("i",{class:"iconfont icon-refresh"},null,-1))],H=["width","height"],J={class:"slide-verify-slider-text"};function K(e,n,s,o,l,u){return t.openBlock(),t.createElementBlock("div",{id:"slideVerify",class:"slide-verify",style:t.normalizeStyle({width:e.w+"px"}),onselectstart:"return false;"},[t.createElementVNode("div",{class:t.normalizeClass({"slider-verify-loading":e.loadBlock})},null,2),t.createElementVNode("canvas",{ref:"canvas",width:e.w,height:e.h},null,8,W),e.show?(t.openBlock(),t.createElementBlock("div",{key:0,class:"slide-verify-refresh-icon",onClick:n[0]||(n[0]=(...d)=>e.refresh&&e.refresh(...d))},G)):t.createCommentVNode("",!0),t.createElementVNode("canvas",{ref:"block",width:e.w,height:e.h,class:"slide-verify-block"},null,8,H),t.createElementVNode("div",{class:t.normalizeClass(["slide-verify-slider",{"container-active":e.containerCls.containerActive,"container-success":e.containerCls.containerSuccess,"container-fail":e.containerCls.containerFail}])},[t.createElementVNode("div",{class:"slide-verify-slider-mask",style:t.normalizeStyle({width:e.sliderBox.width})},[t.createElementVNode("div",{class:"slide-verify-slider-mask-item",style:t.normalizeStyle({left:e.sliderBox.left}),onMousedown:n[1]||(n[1]=(...d)=>e.sliderDown&&e.sliderDown(...d)),onTouchstart:n[2]||(n[2]=(...d)=>e.touchStartEvent&&e.touchStartEvent(...d)),onTouchmove:n[3]||(n[3]=(...d)=>e.touchMoveEvent&&e.touchMoveEvent(...d)),onTouchend:n[4]||(n[4]=(...d)=>e.touchEndEvent&&e.touchEndEvent(...d))},[t.createElementVNode("i",{class:t.normalizeClass(["slide-verify-slider-mask-item-icon","iconfont",`icon-${e.sliderBox.iconCls}`])},null,2)],36)],4),t.createElementVNode("span",J,t.toDisplayString(e.sliderText),1)],2)],4)}var k=P(q,[["render",K],["__scopeId","data-v-2dc70b4c"]]);const Q=function(e){e.component(k.name,k)};p.SlideVerify=k,p.install=Q,Object.defineProperty(p,"__esModule",{value:!0}),p[Symbol.toStringTag]="Module"});
